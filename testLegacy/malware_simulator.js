//{"ts":1479774573.062259,"uid":"CorlbmKROQnCmsFNa","id.orig_h":"192.168.2.230","id.orig_p":50097,"id.resp_h":"98.124.243.43","id.resp_p":80,"proto":"tcp","duration":0.018641,"orig_bytes":0,"resp_bytes":0,"conn_state":"S1","local_orig":true,"local_resp":false,"missed_bytes":0,"history":"Sh","orig_pkts":2,"orig_ip_bytes":128,"resp_pkts":2,"resp_ip_bytes":88,"tunnel_parents":[]}

var fs = require('fs');
var program = require('commander');
var uuid = require("uuid");
var exec = require('child_process').exec;

program.version('0.0.2')
    .option('--dir [in|out]', 'direction')
    .option('--src [src]', 'src')
    .option('--length [length]', 'length')
    .option('--duration [duration]', 'duration')
    .option('--dst [dst]', 'dst');

program.parse(process.argv);

if (program.src == null || program.dst == null) { 
    console.log("Error src/dst required");
}

if (program.duration == null) {
    program.duration = 20;
}

if (program.length == null) {
    program.length = 10000;
}

var cmd = `echo "{\\"ts\\":${Date.now()/1000}, \\"uid\\":\\"${uuid.v4()}\\", \\"id.orig_h\\":\\"${program.src}\\", \\"id.orig_p\\":50097, \\"id.resp_h\\":\\"${program.dst}\\", \\"id.resp_p\\":80, \\"proto\\":\\"tcp\\", \\"duration\\":${program.duration}, \\"orig_bytes\\":${program.length}, \\"resp_bytes\\":${program.length}, \\"conn_state\\":\\"S1\\", \\"local_orig\\":${program.dir=='out'}, \\"local_resp\\":${program.dir=='in'}, \\"missed_bytes\\":0, \\"history\\":\\"Sh\\", \\"orig_pkts\\":2, \\"orig_ip_bytes\\":${(program.length+128)}, \\"resp_pkts\\":2, \\"resp_ip_bytes\\":${program.length+88}, \\"tunnel_parents\\":[]}" >> /blog/current/conndev.log`;
console.log(cmd);
exec(cmd, function(err, stdout, stderr) {
    console.log(stdout, stderr);
})


